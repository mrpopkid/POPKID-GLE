//(function(_0x5d3662,_0x406fc2){const _0x4ad517=_0x2d96,_0x12f396=_0x2499,_0x2f675f=_0x5d3662();while(!![]){try{const _0x5781d3=parseInt(_0x12f396(0x1bc))/0x1+parseInt(_0x4ad517(0x1b6))/0x2+-parseInt(_0x4ad517(0x1a1))/0x3+-parseInt(_0x4ad517(0x1c1))/0x4*(-parseInt(_0x4ad517(0x1c5))/0x5)+-parseInt(_0x4ad517(0x1b1))/0x6+-parseInt(_0x4ad517(0x1ab))/0x7*(-parseInt(_0x12f396(0x1aa))/0x8)+parseInt(_0x12f396(0x1a9))/0x9;if(_0x5781d3===_0x406fc2)break;else _0x2f675f['push'](_0x2f675f['shift']());}catch(_0x3757cb){_0x2f675f['push'](_0x2f675f['shift']());}}}(_0x3f8f,0x24313));import _0x494718 from'../../config.cjs';function _0x2d96(_0x2ae2ac,_0x5b140a){const _0x3f8f59=_0x3f8f();return _0x2d96=function(_0x249989,_0x9ac526){_0x249989=_0x249989-0x19c;let _0x2fb0a3=_0x3f8f59[_0x249989];if(_0x2d96['vDKBRV']===undefined){var _0x202a4c=function(_0x2d9620){const _0x117999='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x13c466='',_0x59df14='';for(let _0xb272cb=0x0,_0x41aae4,_0x46b3ae,_0x494718=0x0;_0x46b3ae=_0x2d9620['charAt'](_0x494718++);~_0x46b3ae&&(_0x41aae4=_0xb272cb%0x4?_0x41aae4*0x40+_0x46b3ae:_0x46b3ae,_0xb272cb++%0x4)?_0x13c466+=String['fromCharCode'](0xff&_0x41aae4>>(-0x2*_0xb272cb&0x6)):0x0){_0x46b3ae=_0x117999['indexOf'](_0x46b3ae);}for(let _0xbf953e=0x0,_0x4777cc=_0x13c466['length'];_0xbf953e<_0x4777cc;_0xbf953e++){_0x59df14+='%'+('00'+_0x13c466['charCodeAt'](_0xbf953e)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x59df14);};_0x2d96['vJFQns']=_0x202a4c,_0x2ae2ac=arguments,_0x2d96['vDKBRV']=!![];}const _0x2c1fe2=_0x3f8f59[0x0],_0x3e7282=_0x249989+_0x2c1fe2,_0x35272d=_0x2ae2ac[_0x3e7282];return!_0x35272d?(_0x2fb0a3=_0x2d96['vJFQns'](_0x2fb0a3),_0x2ae2ac[_0x3e7282]=_0x2fb0a3):_0x2fb0a3=_0x35272d,_0x2fb0a3;},_0x2d96(_0x2ae2ac,_0x5b140a);}const checkChannel=async(_0xbf953e,_0x4777cc)=>{const _0x716c8a=_0x2d96,_0x3e7768=_0x2499,_0x33c5af=_0x494718[_0x3e7768(0x1b5)],_0x2fbb01=_0xbf953e['body'][_0x716c8a(0x1bd)](_0x33c5af)?_0xbf953e[_0x3e7768(0x1a6)][_0x3e7768(0x1a3)](_0x33c5af[_0x3e7768(0x1c0)])[_0x3e7768(0x1ac)]('\x20')[0x0][_0x3e7768(0x1c4)]():'',_0x59ac2f=_0xbf953e[_0x716c8a(0x1b4)][_0x716c8a(0x1a4)](_0x33c5af['length']+_0x2fbb01[_0x3e7768(0x1c0)])[_0x716c8a(0x1c9)]();if(_0x2fbb01===_0x716c8a(0x1a2)||_0x2fbb01==='idch'){if(!_0x59ac2f)return _0x4777cc[_0x3e7768(0x1b3)](_0xbf953e['from'],{'text':_0x3e7768(0x1b0)},{'quoted':_0xbf953e});if(!_0x59ac2f[_0x716c8a(0x19c)](_0x3e7768(0x1b8)))return _0x4777cc[_0x716c8a(0x1ad)](_0xbf953e[_0x716c8a(0x1c3)],{'text':_0x3e7768(0x1bb)},{'quoted':_0xbf953e});try{const _0x125755=_0x59ac2f['split'](_0x3e7768(0x1b8))[0x1],_0x138d39=await _0x4777cc[_0x716c8a(0x1be)](_0x3e7768(0x1c7),_0x125755),_0x45767d=_0x3e7768(0x1ae)+_0x138d39['id']+'\x0a📛\x20*Name:*\x20'+_0x138d39[_0x3e7768(0x1a8)]+_0x716c8a(0x1a0)+_0x138d39[_0x3e7768(0x1af)]+'\x0a📶\x20*Status:*\x20'+_0x138d39['state']+_0x3e7768(0x19e)+(_0x138d39[_0x3e7768(0x1a5)]===_0x716c8a(0x19d)?_0x716c8a(0x1b7):_0x3e7768(0x19f));_0x4777cc[_0x3e7768(0x1b3)](_0xbf953e[_0x3e7768(0x1a7)],{'text':_0x45767d},{'quoted':_0xbf953e});}catch(_0x16568a){console['error']('Channel\x20check\x20error:',_0x16568a),_0x4777cc[_0x3e7768(0x1b3)](_0xbf953e[_0x3e7768(0x1a7)],{'text':_0x3e7768(0x1c6)},{'quoted':_0xbf953e});}}};function _0x2499(_0x2ae2ac,_0x5b140a){const _0x3f8f59=_0x3f8f();return _0x2499=function(_0x249989,_0x9ac526){_0x249989=_0x249989-0x19c;let _0x2fb0a3=_0x3f8f59[_0x249989];return _0x2fb0a3;},_0x2499(_0x2ae2ac,_0x5b140a);}export default checkChannel;function _0x3f8f(){const _0x52ba3e=['cVcFKAuGkKzVBgXVD2vYCZOQia','nZe0mJi1qKv0sMj1','y2vRAwrJAa','slice','C2XPy2u','verification','body','from','name','1329714TyYTtJ','71096KlOJeW','otfLzuPUEM4','split','C2vUze1LC3nHz2u','🎯\x20*Channel\x20Info*\x0a━━━━━━━━━━━━━━\x0a🆔\x20*ID:*\x20','subscribers','❌\x20*Please\x20provide\x20a\x20WhatsApp\x20channel\x20link!*','mte4mduZmfzOywHxwG','215890MDRitF','sendMessage','yM9KEq','PREFIX','nJG3mJH5rfDNyLO','wwvZipcFLlu','https://whatsapp.com/channel/','1180530VhahWZ','mtK5mdC2vfrNq1rO','❌\x20*Invalid\x20link!*\x20Must\x20be\x20a\x20WhatsApp\x20channel\x20link.','199076TTgCTh','C3rHCNrZv2L0Aa','BMv3C2XLDhrLCK1LDgfKyxrH','68728yDWgbZ','length','ofrfsKzxBa','8TEJFWl','zNjVBq','toLowerCase','mJe1odKWtursAxrg','⚠️\x20*Failed\x20to\x20fetch\x20channel\x20info.\x20Please\x20check\x20the\x20link\x20or\x20try\x20again.*','invite','91eeJnzn','DhjPBq','Aw5JBhvKzxm','vKvssuzjruq','\x0a✅\x20*Verified:*\x20','No\x20❌'];_0x3f8f=function(){return _0x52ba3e;};return _0x3f8f();}

import config from '../../config.cjs';

const checkChannel = async (m, Matrix) => {
    const prefix = config.PREFIX;
    const cmd = m.body.startsWith(prefix) 
        ? m.body.slice(prefix.length).split(" ")[0].toLowerCase() 
        : '';
    const text = m.body.slice(prefix.length + cmd.length).trim();

    if (cmd === "cekidch" || cmd === 'idch') {
        if (!text) {
            return Matrix.sendMessage(m.from, {
                text: "❌ *Please provide a WhatsApp channel link!*",
                contextInfo: {
                    forwardedNewsletterMessageInfo: {
                        newsletterName: "Popkid-Xmd",
                        newsletterJid: "120363420342566562@newsletter"
                    }
                }
            }, { quoted: m });
        }

        if (!text.includes("https://whatsapp.com/channel/")) {
            return Matrix.sendMessage(m.from, {
                text: "❌ *Invalid link!* Must be a WhatsApp channel link.",
                contextInfo: {
                    forwardedNewsletterMessageInfo: {
                        newsletterName: "Popkid-Xmd",
                        newsletterJid: "120363420342566562@newsletter"
                    }
                }
            }, { quoted: m });
        }

        try {
            const channelId = text.split("https://whatsapp.com/channel/")[1];
            const info = await Matrix.newsletterMetadata("invite", channelId);

            const channelInfo = `
🎯 *Channel Info*
━━━━━━━━━━━━━━
🆔 *ID:* ${info.id}
📛 *Name:* ${info.name}
👥 *Followers:* ${info.subscribers}
📶 *Status:* ${info.state}
✅ *Verified:* ${info.verification === "VERIFIED" ? "Yes 🔵" : "No ❌"}
`.trim();

            // Button to trigger sending only the channel ID
            const copyBtn = {
                buttonId: `${prefix}sendid ${info.id}`,
                buttonText: { displayText: "📋 Copy Channel ID" },
                type: 1
            };

            const followBtn = {
                buttonId: `https://whatsapp.com/channel/${info.id}`,
                buttonText: { displayText: "➕ Follow Channel" },
                type: 1
            };

            await Matrix.sendMessage(m.from, {
                text: channelInfo,
                buttons: [copyBtn, followBtn],
                headerType: 1,
                footer: "⚡ Popkid-Xmd — Channel Lookup",
                contextInfo: {
                    forwardedNewsletterMessageInfo: {
                        newsletterName: "Popkid-Xmd",
                        newsletterJid: "120363420342566562@newsletter"
                    }
                }
            }, { quoted: m });

        } catch (err) {
            console.error("Channel check error:", err);
            return Matrix.sendMessage(m.from, {
                text: "⚠️ *Failed to fetch channel info. Please check the link or try again.*",
                contextInfo: {
                    forwardedNewsletterMessageInfo: {
                        newsletterName: "Popkid-Xmd",
                        newsletterJid: "120363420342566562@newsletter"
                    }
                }
            }, { quoted: m });
        }
    }

    // If button pressed for sending just the ID
    if (cmd === "sendid") {
        const channelId = text;
        return Matrix.sendMessage(m.from, {
            text: `📋 *Channel ID:* \n\`\`\`${channelId}\`\`\`\n_(Long press to copy)_`
        }, { quoted: m });
    }
};

export default checkChannel;
