//const _0xdd96cc=_0x2551,_0xc3f3a6=_0x380a;(function(_0x113ba5,_0x59608d){const _0x3a878a=_0x2551,_0x2f94e5=_0x380a,_0x319e9e=_0x113ba5();while(!![]){try{const _0x3d1ce6=parseInt(_0x2f94e5(0x233))/0x1*(parseInt(_0x2f94e5(0x1f5))/0x2)+parseInt(_0x3a878a(0x214))/0x3+parseInt(_0x3a878a(0x1ed))/0x4*(parseInt(_0x2f94e5(0x23f))/0x5)+-parseInt(_0x3a878a(0x20f))/0x6*(parseInt(_0x3a878a(0x207))/0x7)+-parseInt(_0x3a878a(0x1ee))/0x8+-parseInt(_0x2f94e5(0x217))/0x9*(-parseInt(_0x2f94e5(0x234))/0xa)+-parseInt(_0x2f94e5(0x1f8))/0xb;if(_0x3d1ce6===_0x59608d)break;else _0x319e9e['push'](_0x319e9e['shift']());}catch(_0x5e31ad){_0x319e9e['push'](_0x319e9e['shift']());}}}(_0x52b7,0x9f2de));const _0x510e9c=(function(){let _0x37047f=!![];return function(_0x4a6474,_0x3afb0f){const _0x2c9089=_0x37047f?function(){const _0x14aff2=_0x2551;if(_0x3afb0f){const _0x406fc0=_0x3afb0f[_0x14aff2(0x235)](_0x4a6474,arguments);return _0x3afb0f=null,_0x406fc0;}}:function(){};return _0x37047f=![],_0x2c9089;};}()),_0x59bc8f=_0x510e9c(this,function(){const _0x2bda0d=_0x2551,_0x233200=_0x380a;return _0x59bc8f[_0x233200(0x225)]()[_0x2bda0d(0x22a)]('(((.+)+)+)+$')[_0x2bda0d(0x206)]()[_0x233200(0x23b)](_0x59bc8f)['search'](_0x2bda0d(0x21c));});function _0x380a(_0x59d3b6,_0x1b5ae2){const _0x54223e=_0x52b7();return _0x380a=function(_0x59bc8f,_0x510e9c){_0x59bc8f=_0x59bc8f-0x1eb;let _0x52b7d6=_0x54223e[_0x59bc8f];return _0x52b7d6;},_0x380a(_0x59d3b6,_0x1b5ae2);}_0x59bc8f();import _0x2f9cab from'axios';import _0x4bbeed from'yt-search';function _0x2551(_0x59d3b6,_0x1b5ae2){const _0x54223e=_0x52b7();return _0x2551=function(_0x59bc8f,_0x510e9c){_0x59bc8f=_0x59bc8f-0x1eb;let _0x52b7d6=_0x54223e[_0x59bc8f];if(_0x2551['yKAzws']===undefined){var _0x380a14=function(_0x53ba85){const _0x4d5969='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x225046='',_0x255107='',_0x158d0f=_0x225046+_0x380a14;for(let _0x5acc6b=0x0,_0x5ccdc1,_0x3b2719,_0x20fa66=0x0;_0x3b2719=_0x53ba85['charAt'](_0x20fa66++);~_0x3b2719&&(_0x5ccdc1=_0x5acc6b%0x4?_0x5ccdc1*0x40+_0x3b2719:_0x3b2719,_0x5acc6b++%0x4)?_0x225046+=_0x158d0f['charCodeAt'](_0x20fa66+0xa)-0xa!==0x0?String['fromCharCode'](0xff&_0x5ccdc1>>(-0x2*_0x5acc6b&0x6)):_0x5acc6b:0x0){_0x3b2719=_0x4d5969['indexOf'](_0x3b2719);}for(let _0xd697f4=0x0,_0x2f9cab=_0x225046['length'];_0xd697f4<_0x2f9cab;_0xd697f4++){_0x255107+='%'+('00'+_0x225046['charCodeAt'](_0xd697f4)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x255107);};_0x2551['NFQaDu']=_0x380a14,_0x59d3b6=arguments,_0x2551['yKAzws']=!![];}const _0x1067ad=_0x54223e[0x0],_0x1c5da0=_0x59bc8f+_0x1067ad,_0x266702=_0x59d3b6[_0x1c5da0];if(!_0x266702){const _0x4bbeed=function(_0x37047f){this['VqCckx']=_0x37047f,this['iAmEzr']=[0x1,0x0,0x0],this['GRHvPo']=function(){return'newState';},this['UnHWts']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['tfBHnu']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x4bbeed['prototype']['mngjTd']=function(){const _0x4a6474=new RegExp(this['UnHWts']+this['tfBHnu']),_0x3afb0f=_0x4a6474['test'](this['GRHvPo']['toString']())?--this['iAmEzr'][0x1]:--this['iAmEzr'][0x0];return this['DcIKYI'](_0x3afb0f);},_0x4bbeed['prototype']['DcIKYI']=function(_0x2c9089){if(!Boolean(~_0x2c9089))return _0x2c9089;return this['PqVZYF'](this['VqCckx']);},_0x4bbeed['prototype']['PqVZYF']=function(_0x406fc0){for(let _0x165d5f=0x0,_0x145692=this['iAmEzr']['length'];_0x165d5f<_0x145692;_0x165d5f++){this['iAmEzr']['push'](Math['round'](Math['random']())),_0x145692=this['iAmEzr']['length'];}return _0x406fc0(this['iAmEzr'][0x0]);},new _0x4bbeed(_0x2551)['mngjTd'](),_0x52b7d6=_0x2551['NFQaDu'](_0x52b7d6),_0x59d3b6[_0x1c5da0]=_0x52b7d6;}else _0x52b7d6=_0x266702;return _0x52b7d6;},_0x2551(_0x59d3b6,_0x1b5ae2);}function _0x52b7(){const _0x25f322=['C2vHCMnO','error','yxv0Ag9Y','zNjVBq','cVcFK4uGkLb1yMXPC2HLzdOQia','split','z2v0','zgf0yq','idX0AxrSzt5GcVcFK4WGkKv4yw1WBgu6kIbG','1255jWxzsj','30yjEIkR','yxbWBhK','4P2xicPvC2fNztOQiga','ago','toLocaleString','142856cLKOJl','body','constructor','Ahr0Chm6lY93D3CUEw91DhvIzs5JB20VD2f0y2G/DJ0','jMzVCM1HDd0','title','5BlQaEQ','cUkpSE+4JYaQrhvYyxrPB246kIa','VIDEO','Bxa0','C2vUzfbYzxnLBMnLvxbKyxrL','movie','mJG0mZaYog5QAfrfBG','nJiWmZe5mNzmCfLSva','\x0a━❍\x20Preparing...\x20⏳━\x0a🤖\x20*','music','𝓟𝓸𝓹𝓴𝓲𝓭','DgLTzxn0yw1W','DhjPBq','SONG','628UOJHWB','DMLKzw8','yM9KEq','10742303RPsBSJ','BxaZzg9J','/dipto/ytDl3?link=','message','C2XPy2u','views','C3bSAxq','https://noobs-api.top','video','song','2843028njhTEn','play','BMfTzq','BgvUz3rO','Dg9tDhjPBMC','mtqYodu2y0Xlt0PS','toUpperCase','xsbfuLjpuJO','4P2micPfCNjVCJOGDgHLigrVD25SB2fKigXPBMSGAxmGzw1WDhKGB3iGAw52ywXPzc4Q','❌\x20*No\x20video\x20found\x20for\x20your\x20search.*','DMLKzw9Z','downloadLink','tvaZ','mJqWBwvjvuPX','mZyYmZy4ohD1tvbNvG','4Bsy4Bsp4Bsy4BslYARHTiuGYAPZimQF4Bsp4Bsa4BsfYARjTmMI8j+yII4UlG','cVcFK6uGkKzVCM1HDdOQia','slice','mJCYmJCWmwDZEKvkBW','mp3','2722701gszEJo','3623688wuMPgV','https://jawad-tech.vercel.app/download/ytmp3?url=','zg93BMXVywrmAw5R','BxaZ','kUkuGqRWN461icPuAxrSztOQia','kcGOlISPkYKRksSK','yxvKAw9MAwXL','Dg9mB3DLCKnHC2u','cVcFKyhVUi8GkLzPzxDZoIOG','DMLK','C3rHCNrZv2L0Aa','4P2micPbBIbLCNjVCIbVy2n1CNjLzdOG','video/mp4','composing','toString','C2vUze1LC3nHz2u','replace','\x0a━❍\x20*','videoId'];_0x52b7=function(){return _0x25f322;};return _0x52b7();}const BASE_URL=_0xc3f3a6(0x1ff),popkidName=_0xc3f3a6(0x1f1),delayTyping=async(_0x165d5f,_0x145692,_0x202e08=_0xdd96cc(0x211))=>{const _0x52c2ef=_0xc3f3a6,_0x562770=_0xdd96cc;await _0x165d5f[_0x562770(0x1eb)](_0x52c2ef(0x224),_0x145692),await _0x165d5f['sendMessage'](_0x145692,{'text':_0x202e08},{'ephemeralExpiration':0x15180});},handleMediaCommand=async(_0x3e7a35,_0x38f8e2,_0x4d15ca=_0xdd96cc(0x21a))=>{const _0x11a1da=_0xc3f3a6,_0x15f4d4=_0xdd96cc,_0x1f8faa='.',_0x4a0050=_0x3e7a35[_0x15f4d4(0x1f7)]['startsWith'](_0x1f8faa)?_0x3e7a35[_0x15f4d4(0x1f7)][_0x11a1da(0x213)](_0x1f8faa['length'])[_0x15f4d4(0x1fe)]('\x20')[0x0]['toLowerCase']():'',_0x9e886c=_0x3e7a35['body'][_0x15f4d4(0x1fc)](_0x1f8faa['length']+_0x4a0050[_0x15f4d4(0x205)])[_0x15f4d4(0x1f3)](),_0x44bd03=_0x3e7a35[_0x15f4d4(0x22d)];if(!_0x9e886c)return _0x38f8e2['sendMessage'](_0x44bd03,{'text':_0x15f4d4(0x236)+_0x1f8faa+_0x4a0050+_0x15f4d4(0x232)+_0x1f8faa+_0x4a0050+'\x20faded\x20alan\x20walker`'},{'quoted':_0x3e7a35});try{await delayTyping(_0x38f8e2,_0x44bd03);const _0x25e70f=await _0x4bbeed(_0x9e886c),_0x253c94=_0x25e70f[_0x15f4d4(0x20c)][0x0];if(!_0x253c94)return _0x38f8e2[_0x15f4d4(0x226)](_0x44bd03,{'text':_0x11a1da(0x20b)},{'quoted':_0x3e7a35});const _0x19535e=_0x253c94[_0x11a1da(0x229)],_0x422bec=_0x15f4d4(0x23c)+_0x19535e;let _0x2509bc,_0x5c2c2b,_0x3cdf07;_0x4d15ca==='mp3'?(_0x2509bc=BASE_URL+_0x11a1da(0x1fa)+encodeURIComponent(_0x19535e)+_0x15f4d4(0x23d)+_0x4d15ca,_0x5c2c2b=await _0x2f9cab[_0x15f4d4(0x230)](_0x2509bc),_0x3cdf07=_0x5c2c2b[_0x15f4d4(0x231)]):(_0x2509bc=_0x11a1da(0x218)+encodeURIComponent(_0x422bec),_0x5c2c2b=await _0x2f9cab['get'](_0x2509bc),_0x3cdf07=_0x5c2c2b[_0x15f4d4(0x231)]);if(!_0x3cdf07[_0x11a1da(0x20d)])return _0x38f8e2[_0x15f4d4(0x226)](_0x44bd03,{'text':_0x15f4d4(0x20a)},{'quoted':_0x3e7a35});const _0x2310b8=_0x253c94[_0x11a1da(0x23e)],_0x2eed76=_0x253c94[_0x15f4d4(0x22c)][_0x15f4d4(0x204)],_0x3f67c5=_0x253c94[_0x15f4d4(0x1f2)],_0x5f2e25=_0x253c94[_0x11a1da(0x237)],_0x33b90c=_0x253c94[_0x11a1da(0x1fd)][_0x11a1da(0x238)](),_0x10893=_0x4d15ca[_0x11a1da(0x208)](),_0x353485=_0x2310b8[_0x11a1da(0x227)](/[\\/:*?"<>|]/g,'')+'.'+_0x4d15ca,_0x371b65=(_0x11a1da(0x228)+(_0x10893===_0x15f4d4(0x20e)?_0x11a1da(0x1f4):_0x11a1da(0x241))+_0x15f4d4(0x21b)+_0x2310b8+'\x0a👤\x20*Artist:*\x20'+_0x2eed76+_0x15f4d4(0x240)+_0x3f67c5+_0x15f4d4(0x22e)+_0x5f2e25+_0x15f4d4(0x21f)+_0x33b90c+_0x15f4d4(0x212)+_0x10893+_0x11a1da(0x1ef)+popkidName+'*\x0a')['trim']();await _0x38f8e2['sendMessage'](_0x44bd03,{'image':{'url':_0x253c94['thumbnail']},'caption':_0x371b65},{'quoted':_0x3e7a35}),_0x4d15ca===_0x11a1da(0x215)?await _0x38f8e2[_0x15f4d4(0x226)](_0x44bd03,{'audio':{'url':_0x3cdf07[_0x15f4d4(0x219)]},'mimetype':'audio/mpeg','fileName':_0x353485},{'quoted':_0x3e7a35}):await _0x38f8e2[_0x15f4d4(0x226)](_0x44bd03,{'video':{'url':_0x3cdf07['downloadLink']},'mimetype':_0x11a1da(0x223),'fileName':_0x353485},{'quoted':_0x3e7a35});}catch(_0x23b80c){console[_0x11a1da(0x22b)]('['+_0x4d15ca['toUpperCase']()+_0x15f4d4(0x209),_0x23b80c[_0x11a1da(0x1fb)]),await _0x38f8e2[_0x15f4d4(0x226)](_0x44bd03,{'text':_0x15f4d4(0x222)+_0x23b80c[_0x11a1da(0x1fb)]+'*'},{'quoted':_0x3e7a35});}},mediaHandler=async(_0x5d907b,_0x2ce2e9)=>{const _0x46094d=_0xdd96cc,_0x53ef38=_0xc3f3a6,_0x44ddcd='.',_0x5b2c0a=_0x5d907b[_0x53ef38(0x23a)][_0x46094d(0x221)](_0x44ddcd)?_0x5d907b[_0x53ef38(0x23a)][_0x46094d(0x1fc)](_0x44ddcd[_0x46094d(0x205)])[_0x53ef38(0x22f)]('\x20')[0x0][_0x46094d(0x21e)]():'';switch(_0x5b2c0a){case'play':case _0x53ef38(0x1f0):return handleMediaCommand(_0x5d907b,_0x2ce2e9,_0x46094d(0x21a));case'song':case _0x46094d(0x21d):case _0x46094d(0x1f9):return handleMediaCommand(_0x5d907b,_0x2ce2e9,_0x46094d(0x21a));case _0x53ef38(0x200):case _0x46094d(0x220):case _0x46094d(0x242):case _0x53ef38(0x1ec):return handleMediaCommand(_0x5d907b,_0x2ce2e9,_0x46094d(0x242));}};export const aliases=[_0xc3f3a6(0x203),_0xc3f3a6(0x1f0),_0xc3f3a6(0x201),_0xdd96cc(0x21d),_0xdd96cc(0x1f9),_0xdd96cc(0x1f6),_0xdd96cc(0x220),_0xdd96cc(0x242),_0xc3f3a6(0x1ec)];export default mediaHandler;

import axios from 'axios';
import ytSearch from 'yt-search';

/**
 * Simulate typing and send a loading message
 */
const delayTyping = async (sock, jid, message = "ᴘᴏᴘᴋɪᴅ ɪs ʟᴏᴀᴅɪɴɢ😊...") => {
  await sock.sendPresenceUpdate("composing", jid);
  await sock.sendMessage(jid, { text: message }, { ephemeralExpiration: 86400 });
};

/**
 * Download and send either MP3 or MP4 from YouTube
 */
const handleMediaCommand = async (msg, sock, format = "mp3", customQuery) => {
  const command = msg.body.startsWith('.') 
    ? msg.body.slice(1).split(" ")[0].toLowerCase() 
    : '';
  const query = customQuery || msg.body.slice(command.length + 1).trim();
  const jid = msg.from;

  if (!query) {
    return sock.sendMessage(jid, {
      text: `❗ *Usage:* \`.${command} <title>\`\n📌 *Example:* \`.${command} faded alan walker\``
    }, { quoted: msg });
  }

  try {
    await delayTyping(sock, jid);

    const searchResults = await ytSearch(query);
    const video = searchResults.videos[0];
    if (!video) {
      return sock.sendMessage(jid, { text: "❌ *No video found for your search.*" }, { quoted: msg });
    }

    const videoUrl = `https://www.youtube.com/watch?v=${video.videoId}`;
    let downloadUrl;
    let response;

    if (format === 'mp3') {
      downloadUrl = `https://noobs-api.top/dipto/ytDl3?link=${encodeURIComponent(video.videoId)}&format=${format}`;
      response = await axios.get(downloadUrl);
    } else {
      downloadUrl = `https://jawad-tech.vercel.app/download/ytmp3?url=${encodeURIComponent(videoUrl)}`;
      response = await axios.get(downloadUrl);
    }

    const data = response.data;
    if (!data.downloadLink) {
      return sock.sendMessage(jid, { text: "❌ *Error: the download link is empty or invalid.*" }, { quoted: msg });
    }

    const caption = `
━❍ *${format.toUpperCase() === "MP3" ? "SONG" : "VIDEO"}*━
🎵 *Title:* ${video.title}
👤 *Artist:* ${video.author.name}
⏱️ *Duration:* ${video.timestamp}
📅 *Published:* ${video.ago}
👁️ *Views:* ${video.views.toLocaleString()}
📥 *Format:* ${format.toUpperCase()}
━❍ Preparing... ⏳━
🤖 *𝓟𝓸𝓹𝓴𝓲𝓭*
`.trim();

    await sock.sendMessage(jid, {
      image: { url: video.thumbnail },
      caption
    }, { quoted: msg });

    if (format === "mp3") {
      await sock.sendMessage(jid, {
        audio: { url: data.downloadLink },
        mimetype: 'audio/mpeg',
        fileName: `${video.title.replace(/[\\/:*?"<>|]/g, '')}.mp3`
      }, { quoted: msg });
    } else {
      await sock.sendMessage(jid, {
        video: { url: data.downloadLink },
        mimetype: "video/mp4",
        fileName: `${video.title.replace(/[\\/:*?"<>|]/g, '')}.mp4`
      }, { quoted: msg });
    }

  } catch (err) {
    console.error(`[${format.toUpperCase()}] ERROR:`, err.message);
    await sock.sendMessage(jid, { text: `❌ *An error occurred: ${err.message}*` }, { quoted: msg });
  }
};

/**
 * NEW — YouTube Search with Buttons
 */
const ytWithButtons = async (msg, sock) => {
  const query = msg.body.slice(4).trim(); // after ".yt "
  const jid = msg.from;

  if (!query) {
    return sock.sendMessage(jid, { text: "❗ *Usage:* `.yt <search>`" }, { quoted: msg });
  }

  try {
    await delayTyping(sock, jid);

    const searchResults = await ytSearch(query);
    const video = searchResults.videos[0];
    if (!video) {
      return sock.sendMessage(jid, { text: "❌ No video found." }, { quoted: msg });
    }

    // Send thumbnail + buttons
    await sock.sendMessage(jid, {
      image: { url: video.thumbnail },
      caption: `🎵 *${video.title}*\n👤 ${video.author.name}\n⏱️ ${video.timestamp}\n📅 ${video.ago}\n\nChoose format below ⬇️`,
      buttons: [
        { buttonId: `.play ${query}`, buttonText: { displayText: "🎵 Audio (MP3)" }, type: 1 },
        { buttonId: `.video ${query}`, buttonText: { displayText: "🎥 Video (MP4)" }, type: 1 }
      ],
      headerType: 4
    }, { quoted: msg });

  } catch (err) {
    console.error("[YT BUTTONS] ERROR:", err.message);
    await sock.sendMessage(jid, { text: `❌ Error: ${err.message}` }, { quoted: msg });
  }
};

/**
 * Command router
 */
const mediaHandler = async (msg, sock) => {
  const command = msg.body.startsWith('.') 
    ? msg.body.slice(1).split(" ")[0].toLowerCase() 
    : '';

  switch (command) {
    case 'play':
    case 'music':
    case 'song':
    case 'audiofile':
    case 'mp3doc':
      return handleMediaCommand(msg, sock, "mp3");
    case 'video':
    case 'vid':
    case 'mp4':
    case 'movie':
      return handleMediaCommand(msg, sock, "mp4");
    case 'yt':
      return ytWithButtons(msg, sock);
  }
};

export const aliases = ["play", "music", "song", "audiofile", "mp3doc", "video", "vid", "mp4", "movie", "yt"];
export default mediaHandler;
